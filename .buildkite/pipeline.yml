env:
  TMPDIR: "/tmp"

steps:
  - command: make test-unit
    agents:
      - queue=linecook
      - hostname=linecook1.svc.use1.isrv.io
    parallelism: 1

  - command: make test-docker-py
    agents:
      - queue=linecook
      - hostname=linecook1.svc.use1.isrv.io

  - command: make test-integration-cli
    agents:
      - queue=linecook
      - hostname=linecook1.svc.use1.isrv.io
    env:
      BUILDKITE_RETRY_COUNT: 10

  - wait

  - command: |-
      touch foo
      make deb
      shopify_hack/upload_to_packagecloud
    agents:
      - queue=linecook
      - hostname=linecook1.svc.use1.isrv.io
    env:
      DOCKER_BUILD_PKGS: ubuntu-trusty
    branches: current_shopify
